(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}})(function(a){a.fn.tweet=function(y){function k(l,f){if(typeof l==="string"){var o=l;for(var h in f){var c=f[h];o=o.replace(new RegExp("{"+h+"}","g"),c===null?"":c)}return o}else{return l(f)}}function z(c,f){return function(){var h=[];this.each(function(){h.push(this.replace(c,f))});return a(h)}}function e(c){return c.replace(/</g,"<").replace(/>/g,"^>")}function x(f,c){return f.replace(b,function(p){var t=/^[a-z]+:/i.test(p)?p:"http://"+p;var o=p;for(var h=0;h<c.length;++h){var l=c[h];if(l.url==t&&l.expanded_url){t=l.expanded_url;o=l.display_url;break}}return'<a href="'+e(t)+'">'+e(o)+"</a>"})}function w(c){return Date.parse(c.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"))}function q(h){var c=arguments.length>1?arguments[1]:new Date;var i=parseInt((c.getTime()-h)/1000,10);var f="";if(i<1){f="just now"}else{if(i<60){f=i+" seconds ago"}else{if(i<120){f="about a minute ago"}else{if(i<45*60){f="about "+parseInt(i/60,10).toString()+" minutes ago"}else{if(i<2*60*60){f="about an hour ago"}else{if(i<24*60*60){f="about "+parseInt(i/3600,10).toString()+" hours ago"}else{if(i<48*60*60){f="about a day ago"}else{f="about "+parseInt(i/86400,10).toString()+" days ago"}}}}}}}return f}function j(c){if(c.match(/^(@([A-Za-z0-9-_]+)) .*/i)){return g.auto_join_text_reply}else{if(c.match(b)){return g.auto_join_text_url}else{if(c.match(/^((\w+ed)|just) .*/im)){return g.auto_join_text_ed}else{if(c.match(/^(\w*ing) .*/i)){return g.auto_join_text_ing}else{return g.auto_join_text_default}}}}}function v(){var f=g.modpath,l=g.fetch===null?g.count:g.fetch,c={include_entities:1};if(g.list){return{host:g.twitter_api_url,url:"/1.1/lists/statuses.json",parameters:a.extend({},c,{list_id:g.list_id,slug:g.list,owner_screen_name:g.username,page:g.page,count:l,include_rts:g.retweets?1:0})}}else{if(g.favorites){return{host:g.twitter_api_url,url:"/1.1/favorites/list.json",parameters:a.extend({},c,{list_id:g.list_id,screen_name:g.username,page:g.page,count:l})}}else{if(g.query===null&&g.username.length===1){return{host:g.twitter_api_url,url:"/1.1/statuses/user_timeline.json",parameters:a.extend({},c,{screen_name:g.username,page:g.page,count:l,include_rts:g.retweets?1:0})}}else{var h=g.query||"from:"+g.username.join(" OR from:");return{host:g.twitter_search_url,url:"/search.json",parameters:a.extend({},c,{page:g.page,q:h,rpp:l})}}}}}function m(f,c){if(c){return"user" in f?f.user.profile_image_url_https:m(f,false).replace(/^http:\/\/[a-z0-9]{1,3}\.twimg\.com\//,"https://s3.amazonaws.com/twitter_production/")}else{return f.profile_image_url||f.user.profile_image_url}}function d(c){var f={};f.item=c;f.source=c.source;f.name=c.from_user_name||c.user.name;f.screen_name=c.from_user||c.user.screen_name;f.avatar_size=g.avatar_size;f.avatar_url=m(c,document.location.protocol==="https:");f.retweet=typeof c.retweeted_status!="undefined";f.tweet_time=w(c.created_at);f.join_text=g.join_text=="auto"?j(c.text):g.join_text;f.tweet_id=c.id_str;f.twitter_base="http://"+g.twitter_url+"/";f.user_url=f.twitter_base+f.screen_name;f.tweet_url=f.user_url+"/status/"+f.tweet_id;f.reply_url=f.twitter_base+"intent/tweet?in_reply_to="+f.tweet_id;f.retweet_url=f.twitter_base+"intent/retweet?tweet_id="+f.tweet_id;f.favorite_url=f.twitter_base+"intent/favorite?tweet_id="+f.tweet_id;f.retweeted_screen_name=f.retweet&&c.retweeted_status.user.screen_name;f.tweet_relative_time=q(f.tweet_time);f.entities=c.entities?(c.entities.urls||[]).concat(c.entities.media||[]):[];f.tweet_raw_text=f.retweet?"RT @"+f.retweeted_screen_name+" "+c.retweeted_status.text:c.text;f.tweet_text=a([x(f.tweet_raw_text,f.entities)]).linkUser().linkHash()[0];f.tweet_text_fancy=a([f.tweet_text]).makeHeart()[0];f.user=k('<a class="tweet_user" href="{user_url}">{screen_name}</a>',f);f.join=g.join_text?k(' <span class="tweet_join">{join_text}</span> ',f):" ";f.avatar=f.avatar_size?k('<a class="tweet_avatar" href="{user_url}"><img src="{avatar_url}" height="{avatar_size}" width="{avatar_size}" alt="{screen_name}\'s avatar" title="{screen_name}\'s avatar" border="0"/></a>',f):"";f.time=k('<span class="tweet_time"><a href="{tweet_url}" title="view tweet on twitter">{tweet_relative_time}</a></span>',f);f.text=k('<span class="tweet_text">{tweet_text_fancy}</span>',f);f.reply_action=k('<a class="tweet_action tweet_reply" href="{reply_url}">reply</a>',f);f.retweet_action=k('<a class="tweet_action tweet_retweet" href="{retweet_url}">retweet</a>',f);f.favorite_action=k('<a class="tweet_action tweet_favorite" href="{favorite_url}">favorite</a>',f);return f}var g=a.extend({modpath:"/twitter/",username:null,list_id:null,list:null,favorites:false,query:null,avatar_size:null,count:3,fetch:null,page:1,retweets:true,intro_text:null,outro_text:null,join_text:null,auto_join_text_default:"i said,",auto_join_text_ed:"i",auto_join_text_ing:"i am",auto_join_text_reply:"i replied to",auto_join_text_url:"i was looking at",loading_text:null,refresh_interval:null,twitter_url:"twitter.com",twitter_api_url:"api.twitter.com",twitter_search_url:"search.twitter.com",template:"{avatar}{time}{join}{text}",comparator:function(f,c){return c.tweet_time-f.tweet_time},filter:function(c){return true}},y);var b=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?Â«Â»â€œâ€â€˜â€™]))/gi;a.extend({tweet:{t:k}});a.fn.extend({linkUser:z(/(^|[\W])@(\w+)/gi,'$1<span class="at">@</span><a href="http://'+g.twitter_url+'/$2">$2</a>'),linkHash:z(/(?:^| )[\#]+([\w\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0600-\u06ff]+)/gi,' <a href="http://'+g.twitter_search_url+"/search?q=&tag=$1&lang=all"+(g.username&&g.username.length==1&&!g.list?"&from="+g.username.join("%2BOR%2B"):"")+'" class="tweet_hashtag">#$1</a>'),makeHeart:z(/(<)+[3]/gi,"<tt class='heart'>&#x2665;</tt>")});return this.each(function(h,l){var i=a('<ul class="tweet_list">');var n='<p class="tweet_intro">'+g.intro_text+"</p>";var f='<p class="tweet_outro">'+g.outro_text+"</p>";var c=a('<p class="loading">'+g.loading_text+"</p>");if(g.username&&typeof g.username=="string"){g.username=[g.username]}a(l).unbind("tweet:load").bind("tweet:load",function(){if(g.loading_text){a(l).empty().append(c)}a.ajax({dataType:"json",type:"post",async:false,url:g.modpath||"/twitter/",data:{request:v()},success:function(r,p){if(r.message){console.log(r.message)}var s=r.response;a(l).empty().append(i);if(g.intro_text){i.before(n)}i.empty();if(s.statuses!==undefined){resp=s.statuses}else{if(s.results!==undefined){resp=s.results}else{resp=s}}var o=a.map(resp,d);o=a.grep(o,g.filter).sort(g.comparator).slice(0,g.count);i.append(a.map(o,function(t){return"<li>"+k(g.template,t)+"</li>"}).join("")).children("li:first").addClass("tweet_first").end().children("li:odd").addClass("tweet_even").end().children("li:even").addClass("tweet_odd");if(g.outro_text){i.after(f)}a(l).trigger("loaded").trigger(o?"empty":"full");if(g.refresh_interval){window.setTimeout(function(){a(l).trigger("tweet:load")},1000*g.refresh_interval)}}})}).trigger("tweet:load")})}});